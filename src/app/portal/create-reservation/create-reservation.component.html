<div class="container">
  <spinner name="create-reservation-spinner"></spinner>
  <app-alert></app-alert>

  <form [formGroup]="createReservationForm">

    <div formArrayName="staysArray" class="col-lg-6 col-lg-offset-0 col-md-6 col-md-offset-0 col-sm-6 col-sm-offset-0 col-xs-10 col-xs-offset-1 no-validation">
      <div [formGroupName]="in" *ngFor="let stay of createReservationForm['controls'].staysArray['controls']; let in = index" class="panel panel-success no-validation">

        <app-form-stay [group]="createReservationForm['controls'].staysArray.controls[in]" 
        [stay]="stay" [in]="in" [staysArray]="createReservationForm['controls'].staysArray" [setSubDateOptions]="subDatePickerOptions"></app-form-stay>

      </div>
      <button class="btn btn-success" (click)="addStay()">Add new period</button>

    </div>

    <div class="col-lg-6 col-lg-offset-0 col-md-6 col-md-offset-0 col-sm-6 col-sm-offset-0 col-xs-10 col-xs-offset-1">

      <!-- Start date -->
      <div class="form-group col-lg-6 col-lg-offset-0 col-md-6 col-md-offset-0 col-sm-6 col-sm-offset-0 col-xs-10 col-xs-offset-1">
        <label>Start date</label>
        <my-date-picker name="startDate" [options]="myDatePickerOptions" (dateChanged)="onStartDateChanged($event)" formControlName="reservationStartDate"
          [(ngModel)]="reservationStartDate"></my-date-picker>
      </div>

      <!-- End date -->
      <div class="form-group col-lg-6 col-lg-offset-0 col-md-6 col-md-offset-0 col-sm-6 col-sm-offset-0 col-xs-10 col-xs-offset-1">
        <label>End date</label>
        <my-date-picker name="endDate" [(options)]="myDatePickerOptions" (dateChanged)="onEndDateChanged($event)" formControlName="reservationEndDate"
          [(ngModel)]="reservationEndDate"></my-date-picker>
      </div>

      <!-- Available spots -->
      <div class="form-group col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 col-xs-10 col-xs-offset-1">
        <div class="well clearfix">
          <div class="col-lg-9 col-lg-offset-0 col-md-9 col-md-offset-0 col-sm-9 col-sm-offset-0 col-xs-9 col-xs-offset-0">
            <h3>Available spots</h3>

            <div *ngIf="availableSpots > 0; then spotSuccess else spotFail"></div>
            <ng-template #spotSuccess>
              <p>There are {{ availableSpots }} spots available.</p>
            </ng-template>
            <ng-template #spotFail>
              <p>There are no spots available.</p>
            </ng-template>
          </div>

          <div class="col-lg-3 col-lg-offset-0 col-md-3 col-md-offset-0 col-sm-3 col-sm-offset-0 col-xs-3 col-xs-offset-0">
            <i class="glyphicon pull-right" [ngClass]="availableSpots > 0 ? 'glyphicon-ok' : 'glyphicon-remove'"></i>
          </div>
        </div>
      </div>

      <!-- Price calculation -->
      <div class="form-group col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 col-xs-10 col-xs-offset-1">
        <div class="well clearfix">
          <div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 col-xs-10 col-xs-offset-1">
            <h3 class="pull-left">Calculated price</h3>
            <h3 class="pull-right">0</h3>
          </div>
        </div>
      </div>

      <div class="form-group col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 col-xs-10 col-xs-offset-1">
        <button type="submit" class="btn btn-success" (click)="saveReservation()" [disabled]="!createReservationForm.valid">Save reservation</button>
      </div>
    </div>
  </form>
</div>